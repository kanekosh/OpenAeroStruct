
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aerodynamic Optimization Walkthrough &#8212; OpenAeroStruct 2.2.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Structural Optimization Example" href="struct_example.html" />
    <link rel="prev" title="Quick Example" href="quick_example.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="struct_example.html" title="Structural Optimization Example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="quick_example.html" title="Quick Example"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.2.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aerodynamic Optimization Walkthrough</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="aerodynamic-optimization-walkthrough">
<span id="id1"></span><h1>Aerodynamic Optimization Walkthrough<a class="headerlink" href="#aerodynamic-optimization-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>This page documents in detail how we perform aerodynamic optimization in OpenAeroStruct.
You should read this page in its entirety to get a feel for how the model is set up and used.</p>
<div class="section" id="openmdao-basics">
<h2>OpenMDAO basics<a class="headerlink" href="#openmdao-basics" title="Permalink to this headline">¶</a></h2>
<p>OpenAeroStruct is a tool written using the <a class="reference external" href="http://openmdao.org/">OpenMDAO</a> framework.
OpenMDAO is an open-source high-performance computing platform for systems analysis and multidisciplinary optimization, written in Python.
Visit OpenMDAO’s <a class="reference external" href="http://openmdao.org/twodocs/versions/latest/index.html">documentation</a> for information on its capabilities and API.</p>
<p>Here is an extremely quick rundown of the basic terminology within OpenMDAO:</p>
<ul class="simple">
<li><p>Component: smallest unit of computational work</p></li>
<li><p>Group: container used to build up model hierarchies</p></li>
<li><p>Driver: controls iterative model execution process (e.g., Optimizer, DOE)</p></li>
<li><p>Problem: top level class that contains everything and provide the model execution API</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/problem_diagram.png"><img alt="diagram of the problem structure" src="_images/problem_diagram.png" style="width: 50%;" /></a>
</div>
</div>
<div class="section" id="intro-to-the-structure-of-the-openaerostruct-problem">
<h2>Intro to the structure of the OpenAeroStruct problem<a class="headerlink" href="#intro-to-the-structure-of-the-openaerostruct-problem" title="Permalink to this headline">¶</a></h2>
<p>In general, you’ll follow these four steps to set up and run a problem in OpenAeroStruct:</p>
<ol class="arabic simple">
<li><p>Define your lifting surface</p></li>
<li><p>Initialize your problem and add flow conditions</p></li>
<li><p>Add your design variables, constraints, and objective</p></li>
<li><p>Set up and run the optimization problem</p></li>
</ol>
<p>We’ll now investigate these steps individually using an aerodynamic optimization case as an example.
The full run script for this case is in <a class="reference internal" href="quick_example.html#quick-example"><span class="std std-ref">Quick Example</span></a>.</p>
<div class="section" id="define-your-lifting-surface">
<h3>1. Define your lifting surface<a class="headerlink" href="#define-your-lifting-surface" title="Permalink to this headline">¶</a></h3>
<p>In the simplest case, you can add a single lifting surface that represents the wing of an aircraft.
To define a lifting surface, you first need to produce a computational mesh that represents that surface.</p>
<p>OpenAeroStruct contains a helper function to create these meshes or you can create your own array of points through another method.
To use OpenAeroStruct’s helper function, you need to give it the number of spanwise points, <cite>num_y</cite>, the number of chordwise points, <cite>num_x</cite>, and the type of baseline planform to start with, <cite>wing_type</cite>.
There are two main options for <cite>wing_type</cite>: <cite>rect</cite>, which is a rectangular wing, and <cite>CRM</cite>, which is based on the Common Research Model wing.
This example uses the <cite>CRM</cite> option.
See the <cite>run_scaneagle.py</cite> example in the <cite>examples/</cite> directory for an example that uses the <cite>rect</cite> option.
The <cite>rect</cite> option is convenient for simple rectangular and trapezoidal planforms.
Alternatively, if you want to create your own custom mesh, see <a class="reference internal" href="custom_mesh_example.html#custom-mesh"><span class="std std-ref">User-Provided Mesh Example</span></a>.</p>
<p>In the code block shown below, we call the helper function to define a mesh and get a starting twist distribution.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>

<span class="kn">from</span> <span class="nn">openaerostruct.geometry.utils</span> <span class="kn">import</span> <span class="n">generate_mesh</span>
<span class="kn">from</span> <span class="nn">openaerostruct.geometry.geometry_group</span> <span class="kn">import</span> <span class="n">Geometry</span>
<span class="kn">from</span> <span class="nn">openaerostruct.aerodynamics.aero_groups</span> <span class="kn">import</span> <span class="n">AeroPoint</span>

<span class="c1"># Create a dictionary to store options about the mesh</span>
<span class="n">mesh_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_y&#39;</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
             <span class="s1">&#39;num_x&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">&#39;wing_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;CRM&#39;</span><span class="p">,</span>
             <span class="s1">&#39;symmetry&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s1">&#39;num_twist_cp&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

<span class="c1"># Generate the aerodynamic mesh based on the previous dictionary</span>
<span class="n">mesh</span><span class="p">,</span> <span class="n">twist_cp</span> <span class="o">=</span> <span class="n">generate_mesh</span><span class="p">(</span><span class="n">mesh_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>There are many options for each surface, and they are loosely organized into the following categories:</p>
<ul class="simple">
<li><p>Wing definition (mesh, wing position, symmetry option, etc)</p></li>
<li><p>Geometric variable definitions (span, dihedral, sweep, twist, etc)</p></li>
<li><p>Aerodynamic performance (CL and CD at angle of attack=0)</p></li>
<li><p>Airfoil properties (turbulence transition point, t/c, location of max t)</p></li>
<li><p>Structural properties (E, G, yield stress, location of spar, etc)</p></li>
<li><p>Options for constraints (KS aggregation, monotonic design variables)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary with info and options about the aerodynamic</span>
<span class="c1"># lifting surface</span>
<span class="n">surface</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Wing definition</span>
            <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;wing&#39;</span><span class="p">,</span>        <span class="c1"># name of the surface</span>
            <span class="s1">&#39;symmetry&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>     <span class="c1"># if true, model one half of wing</span>
                                    <span class="c1"># reflected across the plane y = 0</span>
            <span class="s1">&#39;S_ref_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;wetted&#39;</span><span class="p">,</span> <span class="c1"># how we compute the wing area,</span>
                                     <span class="c1"># can be &#39;wetted&#39; or &#39;projected&#39;</span>
            <span class="s1">&#39;fem_model_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;tube&#39;</span><span class="p">,</span>

            <span class="s1">&#39;twist_cp&#39;</span> <span class="p">:</span> <span class="n">twist_cp</span><span class="p">,</span>
            <span class="s1">&#39;mesh&#39;</span> <span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>

            <span class="c1"># Aerodynamic performance of the lifting surface at</span>
            <span class="c1"># an angle of attack of 0 (alpha=0).</span>
            <span class="c1"># These CL0 and CD0 values are added to the CL and CD</span>
            <span class="c1"># obtained from aerodynamic analysis of the surface to get</span>
            <span class="c1"># the total CL and CD.</span>
            <span class="c1"># These CL0 and CD0 values do not vary wrt alpha.</span>
            <span class="s1">&#39;CL0&#39;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>            <span class="c1"># CL of the surface at alpha=0</span>
            <span class="s1">&#39;CD0&#39;</span> <span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>            <span class="c1"># CD of the surface at alpha=0</span>

            <span class="c1"># Airfoil properties for viscous drag calculation</span>
            <span class="s1">&#39;k_lam&#39;</span> <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>         <span class="c1"># percentage of chord with laminar</span>
                                    <span class="c1"># flow, used for viscous drag</span>
            <span class="s1">&#39;t_over_c_cp&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">]),</span>      <span class="c1"># thickness over chord ratio (NACA0015)</span>
            <span class="s1">&#39;c_max_t&#39;</span> <span class="p">:</span> <span class="o">.</span><span class="mi">303</span><span class="p">,</span>       <span class="c1"># chordwise location of maximum (NACA0015)</span>
                                    <span class="c1"># thickness</span>
            <span class="s1">&#39;with_viscous&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute viscous drag</span>
            <span class="s1">&#39;with_wave&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span>     <span class="c1"># if true, compute wave drag</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-your-problem-and-add-problem-conditions">
<h3>2. Initialize your problem and add problem conditions<a class="headerlink" href="#initialize-your-problem-and-add-problem-conditions" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to initialize the OpenMDAO problem, add flow conditions, and add the groups that contain the analysis components.
In a more complex model, these flow conditions might come from a different OpenMDAO component, but here we hook them up into the model using an independent variable component, or <cite>IndepVarComp</cite>.
Set the values for these parameters that you want to use here.
We then add this component to the OpenMDAO model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the OpenMDAO problem</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1"># Create an independent variable component that will supply the flow</span>
<span class="c1"># conditions to the problem.</span>
<span class="n">indep_var_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">()</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">248.136</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mach_number&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.84</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.e6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;1/m&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.38</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

<span class="c1"># Add this IndepVarComp to the problem model</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;prob_vars&#39;</span><span class="p">,</span>
    <span class="n">indep_var_comp</span><span class="p">,</span>
    <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We now need to provide the geometry and analysis groups to the OpenMDAO problem.</p>
<p>We instantiate and add the <cite>Geometry</cite> group, which computes the new mesh shape based on the current values of the design parameters.
In an optimization context, the driver will change these values, and the geometry group computes the new mesh to use in the analysis components.</p>
<p>We then add an <cite>AeroPoint</cite> group, which contains the analysis components to compute the aerodynamic performance of the lifting surface.
Additionally, we promote the flow condition variables from the group up to the model level.
This means that the values in our IndepVarComp can pass data into this <cite>AeroPoint</cite> group, which is how the aerodynamic analysis knows which flow conditions to use.</p>
<p>We need to connect some of the variables from the <cite>Geometry</cite> group into the <cite>AeroPoint</cite> group.
These connections allow information about the mesh to flow through the model correctly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and add a group that handles the geometry for the</span>
<span class="c1"># aerodynamic lifting surface</span>
<span class="n">geom_group</span> <span class="o">=</span> <span class="n">Geometry</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">surface</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">geom_group</span><span class="p">)</span>

<span class="c1"># Create the aero point group, which contains the actual aerodynamic</span>
<span class="c1"># analyses</span>
<span class="n">aero_group</span> <span class="o">=</span> <span class="n">AeroPoint</span><span class="p">(</span><span class="n">surfaces</span><span class="o">=</span><span class="p">[</span><span class="n">surface</span><span class="p">])</span>
<span class="n">point_name</span> <span class="o">=</span> <span class="s1">&#39;aero_point_0&#39;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">aero_group</span><span class="p">,</span>
    <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Mach_number&#39;</span><span class="p">,</span> <span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;cg&#39;</span><span class="p">])</span>

<span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="c1"># Connect the mesh from the geometry component to the analysis point</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.mesh&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.def_mesh&#39;</span><span class="p">)</span>

<span class="c1"># Perform the connections with the modified names within the</span>
<span class="c1"># &#39;aero_states&#39; group.</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.mesh&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.aero_states.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_def_mesh&#39;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.t_over_c&#39;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_perf.&#39;</span> <span class="o">+</span> <span class="s1">&#39;t_over_c&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-your-design-variables-constraints-and-objective">
<h3>3. Add your design variables, constraints, and objective<a class="headerlink" href="#add-your-design-variables-constraints-and-objective" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is only necessary when performing an optimization and is not needed for only analysis.</p>
</div>
<p>With the problem and surfaces defined, we can now add a description of the
optimization problem.</p>
<p>You can use a certain set of parameters as design variables, including:</p>
<ul class="simple">
<li><p>angle of attack</p></li>
<li><p>taper</p></li>
<li><p>span</p></li>
<li><p>dihedral</p></li>
<li><p>sweep</p></li>
<li><p>chord distribution</p></li>
<li><p>twist distribution</p></li>
<li><p>shear deformation in x direction</p></li>
<li><p>shear deformation in y direction</p></li>
<li><p>structural spar radius distribution</p></li>
<li><p>structural spar thickness distribution</p></li>
</ul>
<p>For the constraints and objective, you can use any outputted variable.
Common constraints include:</p>
<ul class="simple">
<li><p>structural failure</p></li>
<li><p>CL = fixed value</p></li>
<li><p>monotonic constraint on spanwise variable (e.g. chord can only get decrease as you go outboard)</p></li>
</ul>
<p>Common objectives include:</p>
<ul class="simple">
<li><p>weight</p></li>
<li><p>fuel burn</p></li>
<li><p>CL</p></li>
<li><p>CD</p></li>
</ul>
<p>We also tell the OpenMDAO problem to record information about each optimization iteration.
This will allow us to visualize the history during and after the optimization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the Scipy Optimizer and set the driver of the problem to use</span>
<span class="c1"># it, which defaults to an SLSQP optimization method</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>

<span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s2">&quot;aero_analysis_test.db&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;record_derivatives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s1">&#39;includes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>

<span class="c1"># Setup problem and add design variables, constraint, and objective</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s1">&#39;wing.twist_cp&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">10.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">15.</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.wing_perf.CL&#39;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">point_name</span> <span class="o">+</span> <span class="s1">&#39;.wing_perf.CD&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-and-run-the-optimization-problem">
<h3>4. Set up and run the optimization problem<a class="headerlink" href="#set-up-and-run-the-optimization-problem" title="Permalink to this headline">¶</a></h3>
<p>With the problem defined, we can now actually run the optimization.
If you only wanted to perform analysis, not optimization, you could use <cite>prob.run_model()</cite> instead of <cite>prob.run_driver()</cite> in the code below.</p>
<p>The code below find the lowest <cite>CD</cite> value while providing a certain amount of lift by constraining <cite>CL</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up and run the optimization problem</span>
<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell border-box-sizing code_cell rendered"><div class="output_area"><pre>Optimization terminated successfully    (Exit mode 0)
            Current function value: [333.89699872]
            Iterations: 18
            Function evaluations: 18
            Gradient evaluations: 18
Optimization Complete
-----------------------------------
0.0333896998716508
0.49999999999999667
-1.788555037237238
</pre></div></div></div>
</div>
<div class="section" id="investigation-of-the-problem-structure-n2-diagram">
<h2>Investigation of the problem structure – N2 diagram<a class="headerlink" href="#investigation-of-the-problem-structure-n2-diagram" title="Permalink to this headline">¶</a></h2>
<p>We’ll now take a moment to explain the organization of the aerodynamic model.</p>
<iframe width='1200' height='700' style='border: 1px solid lightgray; resize: both;' src='./generate_n2_n2.html'></iframe><p>Mouse over components and parameters to see the data-passing connections between them.
You can expand this view, click on boxes to zoom in, or right-click to collapse boxes.
This shows the layout of the components within the OpenAeroStruct model.
There’s also a help button (the ? mark) on the far right of the top toolbar with information about more features.</p>
<p>To create this diagram for any OpenMDAO problem, add these two lines after you call <cite>prob.setup()</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openmdao.api</span> <span class="kn">import</span> <span class="n">n2</span>
<span class="n">n2</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
</pre></div>
</div>
<p>Use any web browser to open the <cite>.html</cite> file and you can examine your problem layout.
This diagram shows groups in dark blue, components in light blue, as organized by your actual problem hierarchy.
Parameters (inputs and outputs) are shown on the diagonal, with off-diagonal terms representing where an output from a component is passed as input to another component.
Any red parameters shown are unconnected inputs, which means that those parameters are not receiving any data from another component.
In general this is bad – it suggests that the model is not set up properly – but if you want to use the default value of those inputs, then it’s OK.
For example, we currently have unconnected inputs in the geometry group within OpenAeroStruct, but this is allowable because the default values used in that group are correct and do not modify the mesh.</p>
</div>
<div class="section" id="how-to-visualize-results">
<h2>How to visualize results<a class="headerlink" href="#how-to-visualize-results" title="Permalink to this headline">¶</a></h2>
<p>You can visualize the lifting surface and structural spar using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">plot_wing aero.db</span>
</pre></div>
</div>
<p>Here you’ll use <cite>aero.db</cite> or the filename for where you saved the problem data.
This will produce a window where you can see how the lifting surface and design variables change with each iteration, as shown below.
You can monitor the results from your optimization as it progresses by checking the <cite>Automatically refresh</cite> button.</p>
<img alt="_images/aero.png" src="_images/aero.png" />
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_example.html">Quick Example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Aerodynamic Optimization Walkthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#openmdao-basics">OpenMDAO basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intro-to-the-structure-of-the-openaerostruct-problem">Intro to the structure of the OpenAeroStruct problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#investigation-of-the-problem-structure-n2-diagram">Investigation of the problem structure – N2 diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-visualize-results">How to visualize results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="struct_example.html">Structural Optimization Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_walkthrough.html">Aerostructural Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_wingbox_walkthrough.html">Aerostructural with Wingbox Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_mesh_example.html">User-Provided Mesh Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">More Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specialty_topics.html">Specialty Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="v1_v2_conversion.html">OpenAeroStruct v1 to v2 Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_contribute.html">How to Contribute to OpenAeroStruct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_srcdocs/index.html">Source Docs</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="struct_example.html" title="Structural Optimization Example"
             >next</a> |</li>
        <li class="right" >
          <a href="quick_example.html" title="Quick Example"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.2.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aerodynamic Optimization Walkthrough</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, John Jasa, Dr. John Hwang, Justin S. Gray.
      Last updated on Jan 30, 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>